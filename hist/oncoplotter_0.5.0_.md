# Documentation for the `OncoPlotter` package.
  
----------------------------------------------------------------
 
 *OncoPlotter--A SAS package to create figures commonly created in oncology studies* 
  
----------------------------------------------------------------
 
### Version information:
  
- Package: OncoPlotter
- Version: 0.5.0
- Generated: 2026-02-09T18:47:07
- Author(s): [Yutaka Morioka],[Hiroki Yamanobe],[Ryo Nakaya]
- Maintainer(s): [Yutaka Morioka],[Hiroki Yamanobe],[Ryo Nakaya]
- License: MIT
- File SHA256: `F*075B86344E7E2EDC66FA6680BB3834D87EF3A7D013FCC76EADAE81A7FF33ABB8` for this version
- Content SHA256: `C*16E8FA838898DFF47FD08D5A432DFB88E85526CCB78BF8FE0D0EE70A1822C12E` for this version
  
---
 
# The `OncoPlotter` package, version: `0.5.0`;
  
---
 
##  OncoPlotter
**A SAS package to create figures commonly used in oncology studies.**
OncoPlotter is a SAS macro package designed to easily generate key figures typically required in oncology clinical trials.
It supports Kaplan-Meier plots, Swimmer plots, Waterfall plots, Forest Plot and Spider Plot ready for both clinical study reports and publications.
The package also provides dummy datasets, allowing you to test each macro without preparing your own data.
This makes it especially useful for both beginners and advanced users in the oncology data field.
### Main Features
- **Kaplan-Meier Plot (`%kaplan_meier_plot`)**
- Creates survival curves by treatment group
- Displays censoring marks and number-at-risk below the plot
- Fully customizable axis labels, line colors, patterns, and plot titles
- Option to output generated SAS code via the `MFILE` option
- Includes internal dummy dataset (`dummy_adtte`) for quick testing
- **Swimmer Plot (`%swimmer_plot`)**
- Visualizes individual treatment durations, responses, ongoing treatments, and death
- Accepts ADSL and ADRS-format input datasets
- Color grouping by disease stage and response categories (e.g., CR, PR, SD, PD)
- Allows customization of plot size, subjects per page, and theme colors
- Supports predefined color styles like "OncoPlotter", "Kyoto", "Osaka", and more
- **Waterfall Plot (`%waterfall_plot`)**
- Displays percentage tumor size change for each subject as bars
- Bars are grouped and color-coded by response or treatment group
- Includes threshold lines for PR/PD classification
- Suitable for visualizing best overall response
### Usage
For more details, please visit https://github.com/PharmaForest/OncoPlotter]
---
  
---
 
  
---
 
Required SAS Components: 
  - Base SAS Software
  
---
 
 
--------------------------------------------------------------------
 
*SAS package generated by SAS Package Framework, version `20250729`*
 
--------------------------------------------------------------------
 
# The `OncoPlotter` package content
The `OncoPlotter` package consists of the following content:
 
1. [`_01_adsl_dummy` data ](#01adsldummy-data-1 )
2. [`_02_adrs_dummy` data ](#02adrsdummy-data-2 )
3. [`_03_adtr_dummy` data ](#03adtrdummy-data-3 )
4. [`%forest_plot()` macro ](#forestplot-macros-4 )
5. [`%kaplan_meier_plot()` macro ](#kaplanmeierplot-macros-5 )
6. [`%sp_change()` macro ](#spchange-macros-6 )
7. [`%sp_make_groupf_format()` macro ](#spmakegroupfformat-macros-7 )
8. [`%sp_make_respf_format()` macro ](#spmakerespfformat-macros-8 )
9. [`%sp_split_plot()` macro ](#spsplitplot-macros-9 )
10. [`%spider_plot()` macro ](#spiderplot-macros-10 )
11. [`%swimmer_plot()` macro ](#swimmerplot-macros-11 )
12. [`%waterfall_plot()` macro ](#waterfallplot-macros-12 )
  
 
13. [License note](#license)
  
---
 
## `_01_adsl_dummy` data <a name="01adsldummy-data-1"></a> ######

## Create dummy datasets
ADSL_DUMMY

  
---
 
## `_02_adrs_dummy` data <a name="02adrsdummy-data-2"></a> ######

## Create dummy datasets
ADRS_DUMMY

  
---
 
## `_03_adtr_dummy` data <a name="03adtrdummy-data-3"></a> ######

## Create dummy datasets
ADTR_DUMMY

  
---
 
## `%forest_plot()` macro <a name="forestplot-macros-4"></a> ######

Macro:    forest_plot

Purpose:  
  Create a forest plot using PROC SGPLOT.
  The macro draws point estimates and confidence intervals and displays
  up to six descriptive columns on the left side using YAXISTABLE.
  Optional reference line and code generation (mprint dump) are supported.

Parameters:  
  data            Input dataset  
                  (default: dummy_forest_test)

  out1-out6       Variable names to be displayed on the left side
                  using YAXISTABLE (optional)

  marker_point    Variable for point estimate
                  (default: estimate)

  bar_left        Variable for lower confidence limit
                  (default: lower_limit)

  bar_right       Variable for upper confidence limit
                  (default: upper_limit)

  out1_label      Label for out1 column
  out2_label      Label for out2 column
  out3_label      Label for out3 column
  out4_label      Label for out4 column
  out5_label      Label for out5 column
  out6_label      Label for out6 column

  AxisValues      X-axis values specification passed to
                  XAXIS VALUES=()
                  (default: 0.0 to 2.5 by 0.5)

  refline_value   Reference line value on X-axis
                  (default: 1)

  bar_color       Color of confidence interval bars
                  (default: black)

  marker_color    Color of marker points
                  (default: black)

  Generate_Code   Output expanded macro code (mprint) to a text file
                  in the WORK directory and open it
                  (Y/N, default: N)

Output:  
  - Forest plot generated by ODS Graphics
  - WORK.wk_forest      : plotting dataset
  - WORK.forest_anno    : SG annotation dataset
  - forest_plot<index>.txt (when Generate_Code=Y)

Usage Example:  
  %forest_plot(
    data=dummy_forest_test,
    out1=col1,
    out2=col2,
    out3=col3,
    out4=col4,
    out5=col5,
    marker_point=estimate,
    bar_left=lower_limit,
    bar_right=upper_limit,
    out1_label=%nrbquote(Sub Group),
    out2_label=%nrbquote(n),
    out3_label=%nrbquote(%),
    out4_label=%nrbquote(HR),
    out5_label=%nrbquote(HR 95 %CL),
    AxisValues=%nrbquote(0.0 to 2.5 by 0.5),
    refline_value=1,
    bar_color=black,
    marker_color=black,
    Generate_Code=Y
  );

  
---
 
## `%kaplan_meier_plot()` macro <a name="kaplanmeierplot-macros-5"></a> ######

* Program:     kaplan_meier_plot.txt
* Macro:       %kaplan_meier_plot
*
* Purpose:     This macro generates Kaplan-Meier survival plots using PROC LIFETEST in SAS.
*              It produces survival curves by group, displays censoring marks, and includes
*              the number at risk at each time point on the plot.
*
* Features:
*   - Optionally generates an internal example dataset (e.g., `dummy_adtte`)
*   - Customizable group labels, colors, and line patterns
*   - Supports plotting of censored observations
*   - Configurable axis and display settings
*   - Supports MFILE option to export generated SAS code
*
* Parameters:
*   data=                  Input dataset name (e.g., dummy_adtte)
*   groupn=                Numeric group variable (e.g., TRTPN)
*   groupc=                Character group label variable (e.g., TRTP)
*   wh=                    WHERE condition to subset data (optional)
*   Time_var=              Time-to-event variable (e.g., AVAL)
*   Censore_var=           Censoring indicator variable (e.g., CNSR)
*   Censore_val=           Value indicating censored observations (e.g., 1)
*   Title=                 Plot title (default: "Kaplan-Meier Plot")
*   Group_color_list=      Color list for group lines (e.g., "black red blue green")
*   Group_linepattern_list= Line pattern list for groups (e.g., "solid dash longdash dot")
*   XLABEL=                Label for the X-axis (e.g., "Survival Time (Month)")
*   YLABEL=                Label for the Y-axis (e.g., "Probability of Survival")
*   AxisValues=            Tick marks for the X-axis (e.g., "0 to 16 by 2")
*   Delete_Process_Data=   Option to delete intermediate datasets (Y/N, not used)
*   Generate_Code=         Option to output MFILE-generated SAS code (Y/N)
*
* Example usage:
*   %kaplan_meier_plot(
*       data = dummy_adtte,
*       groupn = TRTPN,
*       groupc = TRTP,
*       Time_var = AVAL,
*       Censore_var = CNSR,
*       Censore_val = 1,
*       Title = %nrquote(Kaplan-Meier Curve Example),
*       Group_color_list = %nrquote(black red blue green),
*       Group_linepattern_list = %nrquote(solid dash longdash shortdash),
*       XLABEL = %nrquote(Survival Time (Month)),
*       YLABEL = %nrquote(Probability),
*       AxisValues = %nrquote(0 to 24 by 4),
*       Generate_Code = Y
*   );
*
* Author:     Yutaka Morioka
* First Release Date:        2025-06-24
* Update:     2025-09-01 (Bug Fix)
* Update:	 2025-09-16 (minor change)
* Update:	 2026-02-05 (bug fix--generate coe)

  
---
 
## `%sp_change()` macro <a name="spchange-macros-6"></a> ######

This is internal utility macro used in `%swimmer_plot`.
Purpose:
Change separater of | to "","" (e.g. CR | PR | SD   ->   "CR","PR","SD")
* Author:     Ryo Nakaya
* Date:        2025-07-05
* Version:     0.1

  
---
 
## `%sp_make_groupf_format()` macro <a name="spmakegroupfformat-macros-7"></a> ######

This is internal utility macro used in `%swimmer_plot`.
Purpose:
Create format for groupvar (e.g.
	proc format ;
		value groupf
		1 = "Stage I"
		2 = "Stage II"
		;
	run ;
* Author:     Ryo Nakaya
* Date:        2025-07-05
* Version:     0.1

  
---
 
## `%sp_make_respf_format()` macro <a name="spmakerespfformat-macros-8"></a> ######

This is internal utility macro used in `%swimmer_plot`.
Purpose:
Create format for response (e.g.
	proc format ;
		value respf
		1 = "CR"
		2 = "PR"
		;
	run ;
* Author:     Ryo Nakaya
* Date:        2025-07-05
* Version:     0.1

  
---
 
## `%sp_split_plot()` macro <a name="spsplitplot-macros-9"></a> ######

This is internal macro used in `%swimmer_plot`.
This macro is main functionality including sgplot.
* Author:     Ryo Nakaya
* Latest Date: 2025-10-29

  
---
 
## `%spider_plot()` macro <a name="spiderplot-macros-10"></a> ######


Macro:    spider_plot

Purpose:  
  Create a spider (subject profile) plot using PROC SGPLOT.
  The macro draws a series line (with markers) for each subject across
  the specified X variable (e.g., study day) and Y variable (e.g., percent change).
  Optional reference lines, custom axis labels/values, and code generation
  (mprint dump) are supported.
  A dummy input dataset is created within the macro for demonstration.

Parameters:  
  data               Input dataset  
                     (default: dummy_spider)

  xvar               X variable for the horizontal axis
                     (default: ADY)

  yvar               Y variable for the vertical axis
                     (default: PCHG)

  subject_var        Subject identifier used as GROUP= for the series
                     (default: SUBJID)

  subject_category   Optional category variable intended for color control
                     via GROUPLC=/GROUPMC= in the SERIES statement
                     (default: BOR)

  xaxis_label        X-axis label
                     (default: Days)

  xaxis_values       X-axis values specification passed to
                     XAXIS VALUES=()
                     (default: 0 43 85 127 169 191 213 235)

  yaxis_label        Y-axis label
                     (default: Change rate from baseline (%))

  yaxis_values       Y-axis values specification passed to
                     YAXIS VALUES=()
                     (default: -100 -75 -50 -30 0 20 50 75 100)

  datacontrastcolors Color list for group lines/markers passed to
                     STYLEATTRS DATACONTRASTCOLORS=()
                     (default: Blue Red Green Yellow)

  refline_value      Reference line value(s) on Y-axis
                     (default: 0 20 -30)

  curvelabel         Display curve labels on the series lines
                     (Y/N, default: Y)

  Generate_Code      Output expanded macro code (mprint) to a text file
                     in the WORK directory and open it
                     (Y/N, default: N)

Output:  
  - Spider plot generated by ODS Graphics
  - WORK.dummy_spider : demonstration dataset created within the macro
  - spider_plot<index>.txt (when Generate_Code=Y)

Usage Example:  
  %spider_plot(
    data = dummy_spider,
    xvar = ADY,
    yvar = PCHG,
    subject_var = SUBJID,
    subject_category = BOR,
    xaxis_label = %nrbquote(Days),
    xaxis_values = %nrbquote(0 43 85 127 169 191 213 235),
    yaxis_label = %nrbquote(Change rate from baseline (%)),
    yaxis_values = %nrbquote(-100 -75 -50 -30 0 20 50 75 100),
    datacontrastcolors = %nrbquote(Blue Red Green Yellow),
    refline_value = 0 20 -30,
    curvelabel = Y,
    Generate_Code = N
  );

  
---
 
## `%swimmer_plot()` macro <a name="swimmerplot-macros-11"></a> ######

### Macro:
%Swimmer_Plot
### Purpose:
Creates a swimmer plot to visualize treatment duration, response duration (CR/PR),
and clinical events (e.g., death) for each subject using ADaM datasets.
### Parameters:
#### Data inputs
- `adrs` (required) :
Response dataset (BDS ADaM).
Expected variables include `USUBJID`, `AVAL`, `AVALC`, `ADT`, `ADY`.
- `adsl` (required) :
Subject-level dataset (ADSL ADaM).
Expected variables include `USUBJID`, `SUBJID`, `TRTSDT`, `TRTEDT`, `DTHDT`
and the variable specified in `eotvar`.
- `whr_adrs` (optional, default=blank) :
WHERE condition applied to the response dataset.
- `whr_adsl` (optional, default=blank) :
WHERE condition applied to the subject-level dataset.
- `eotvar` (required) :
End-of-treatment status variable.
If its value equals `"ONGOING"` (case-insensitive), an arrow endcap is drawn.
- `lstvstdt` (optional, default=blank) :
Alternative last visit date used when `TRTEDT` is missing or incomplete.
Treatment duration is calculated as `min(TRTEDT, lstvstdt) - TRTSDT + 1`.
#### Response definition
- `crprN` (optional, default=`1 2`) :
Numeric values of `AVAL` considered as CR or PR.
- `responseN` (required, default=`1 2 3 4`) :
Numeric values of response categories.
- `responseC` (required, default=`CR | PR | SD | PD`) :
Character labels corresponding to `responseN`.
Values must be separated by `|`.
- `responseLabel` (optional, default=`Response`) :
Label for response legend.
#### Durable response display
- `durable` (optional, default=`Y`) :
Specifies whether response-duration (durable period) lines are drawn.
- `durableLabel` (optional, default=`Response period`) :
Legend label for the durable response period.
#### Grouping
- `groupvar` (optional, default=blank) :
Numeric grouping variable in `adsl`.
- `groupN` (optional, default=blank) :
Numeric values for the grouping variable.
- `groupC` (optional, default=blank) :
Character labels for the grouping variable.
Values must be separated by `|`.
- `groupLabel` (optional, default=blank) :
Legend label for grouping categories.
#### Event labels
- `deathLabel` (optional, default=`Death`) :
Legend label for death marker.
- `ongoingLabel` (optional, default=`Treatment Ongoing`) :
Legend label for ongoing-treatment indicator.
#### Layout and appearance
- `nperpage` (optional, default=`20`) :
Number of subjects displayed per page.
- `width` (optional, default=`640`) :
Width of the output graphic in pixels.
- `height` (optional, default=`480`) :
Height of the output graphic in pixels.
- `subjidOn` (optional, default=`Y`) :
Displays subject ID when set to `Y`.
- `title` (optional, default=blank) :
Title of the plot.
- `ytitle` (optional, default=`Subject`) :
Title of the y-axis.
- `xtitle` (optional, default=`Days from Treatment Start`) :
Title of the x-axis.
- `xvalues` (optional, default=blank) :
X-axis tick specification (e.g., `0 to 40 by 4`).
- `nolegend` (optional, default=blank) :
Suppresses legend when set to `Y`.
#### Style
- `colorStyle` (optional, default=`OncoPlotter`) :
Preset color style.
Supported values include `OncoPlotter`, `Salmon`, `Kawaii`, `Kyoto`, `Osaka`.
- `groupColor` (optional, default=`orange`) :
Color for group categories when `colorStyle` is blank.
- `markerColor` (optional, default=`red`) :
Color for markers when `colorStyle` is blank.
- `markerSymbol` (optional, default=blank) :
Marker symbol when `colorStyle` is blank.
#### Time scale
- `interval` (optional, default=blank) :
Time-unit conversion.
Permitted values (case-insensitive):
- `WEEK`  : days divided by 7
- `MONTH` : days divided by 30.4375
#### Code generation
- `Generate_Code` (optional, default=`Y`) :
When set to `Y`, generates the underlying program code
and writes it to a text file in the WORK directory.
~~~sas
%Swimmer_Plot(
	adrs				= adrs_dummy,
	adsl				= adsl_dummy,
	whr_adrs			= PARAM="Overall Response" and PARQUAL="IRC",
	whr_adsl			= FASFL="Y",
	eotvar 			= EOTSTT,
	lstvstdt			= ,
	crprN 			= 1 2,
	durable			= Y,
	durableLabel 	= Durable Period,
	groupvar 			= STAGEN,
	groupLabel 		= Disease Stage,
	groupN 			= 1 2 3 4 5,
	groupC 			= Stage I | Stage IIa | Stage IIb | Stage III | Stage IV,
	responseN 		= 1 2 3 4,
	responseC 		= CR | PR | SD | PD,
	responseLabel 	= Response,
	deathLabel 		= Death,
	ongoingLabel 	= Treatment Ongoing,
	nperpage 		= 20,
	width 				= 640,
	height				= 480,
	subjidOn		 	= Y,
	colorStyle 		= OncoPlotter,
	groupColor 		= ,
	markerColor 	= ,
	markerSymbol 	= ,
	title 				= Swimmer%str(%')s Plot,
	ytitle 				= Subject,
	xtitle 				= Days from treatment,
	xvalues 			= 0 to 40 by 4,
	nolegend			= ,
	interval 			= week,
	Generate_Code = Y
)
~~~
### prerequisites
- Response data		: BDS ADaM dataset
		(USUBJID, AVAL, ADT, ADY)
- Subject-level-data	: ADSL ADaM dataset
		(USUBJID, SUBJID, TRTSDT, TRTEDT, DTHDT)
### URL:
https://github.com/PharmaForest/OncoPlotter
* Author:     Ryo Nakaya
* Latest udpate Date:        2026-01-19

  
---
 
## `%waterfall_plot()` macro <a name="waterfallplot-macros-12"></a> ######

/*************************************************************************
* Program:     Waterfall_Plot.sas
* Macro:       %Waterfall_Plot
*
* Purpose:     This macro generates a Waterfall Plot using ADaM datasets
*              (ADSL, ADTR, ADRS) to visualize tumor size changes from baseline.
*
* Features:
*   - Plots percent change in tumor size (e.g., from baseline to nadir)
*   - Supports grouping by Best Overall Response (BOR) or any other variable
*   - Custom group labels, color coding, and legend display
*   - Flexible WHERE conditions for subsetting each dataset
*   - Customizable axis range, plot title, width, and height
*   - Option to output SAS code
*
* Parameters:
*   adrs=           Input response dataset (e.g., ADRS with BOR)
*   adtr=           Tumor measurements dataset (e.g., ADTR with SUMDIA)
*   adsl=           Subject-level dataset (e.g., ADSL)
*
*   whr_adrs=       where condition for selecting best response per subject (e.g. PARAMCD="BORIRC")
*   whr_adtr=       where condition to select the best sum of diameters per subject (e.g. PARAMCD="SUMDIA" and ANL01FL="Y")
*   whr_adsl=       where condition for subject-level data (e.g. FASFL="Y")
*
*   groupVar=       Numeric variable used for grouping subjects (e.g., based on BOR)
*   groupLabel=     Character variable used for group labels (e.g., BOR term)
*   groupN=         List of numeric group values (e.g., 1 2 3)
*   groupC=         List of character group labels (e.g., "CR" "PR" "SD")
*   groupColor=     Color list for group bars (e.g., red blue green)
*
*   responseVar=    Numeric variable plotted on Y-axis (e.g., percent change in tumor size)
*   varWidth=       Width of var (default: 0.7)
*
*   width=          Width of the plot in pixels (default: 840)
*   height=         Height of the plot in pixels (default: 480)
*   dpi=            DPI of the plot  (default: 300)
*   imgPath=        Path of Image file (default: SAS Temporary Files)
*
*   title=          Title of the plot (e.g., "Waterfall Plot of Tumor Shrinkage")
*   ytitle=         Label for the Y-axis (e.g., "Change from Baseline (%)")
*   yvalues=        Range and increment for the Y-axis (e.g., -100 to 100 by 20)
*   y_refline=  referrence line (e.g. -30 20)
*
*   Generate_Code=  Option to output generated SAS code via MFILE (Y/N)
*
* Example usage:
******************************
* Example 1:
*   %Waterfall_Plot(
*     adrs = ADRS,
*     adtr = ADTR,
*     adsl = ADSL,
*     whr_adrs = PARAMCD = "BOR",
*     whr_adtr = PARAMCD = "SLD",
*     whr_adsl = SAFFL = "Y",
*     groupVar = GROUPN,
*     groupLabel = GROUPC,
*     groupN = 1 2 3,
*     groupC = "CR" "PR" "SD",
*     groupColor = red blue green,
*     responseVar = PCHG,
*     width = 840,
*     height = 480,
*     title = %nrquote(Waterfall Plot of Best Tumor Response),
*     ytitle = %nrquote(Change from Baseline (%)),
*     yvalues = -100 to 100 by 20,
*     Generate_Code = Y
*   );
*
******************************
* Example 2:
%Waterfall_Plot(
adrs      = adrs_dummy,
adtr      = adtr_dummy,
adsl      = adsl_dummy,
whr_adrs    = PARAM="Best Overall Response",
whr_adtr    = PARAM="Sum of Diameters" and PARQUAL="IRC" and TRGRPID="TARGET" and ANL01FL="Y",
whr_adsl    = FASFL="Y",
groupVar     = AVAL,
groupN       = 1 2 3 4,
groupC       = CR | PR | SD | PD,
groupLabel   = Best Overall Response:,
groupColor   = green | blue | gray | red,
responseVar  = PCHG,
VarWidth     = 0.7,
width     = 840,
height    = 480,
dpi       = 300,
imgPath   = C:/temp,
title   = Figure 14.2.x,
ytitle  = Change from Baseline (%),
yvalues = -100 to 100 by 20,
y_refline=20 40,
Generate_Code = Y
);
*
* Author:     Hiroki Yamanobe
* Latest udpate Date:       2025-10-08

  
---
 
  
---
 
# License <a name="license"></a> ######
 
Copyright (c) [2025]  [Yutaka Morioka],[Hiroki Yamanobe],[Ryo Nakaya]
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
  
---
 
